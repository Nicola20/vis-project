<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Videogame Sunburst</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}"></link>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='interaction.js') }}"></script>
    <!-- <script src="https://d3js.org/d3.v5.min.js"></script> -->

</head>
<body>
    <!--
    <div class="categories">
        <div class="category">Rank</div>
        <div class="category">Platform</div>
        <div class="category">Name</div>
        <div class="category">Year</div>
        <div class="category">Genre</div>
        <div class="category">Sales</div>
        <div class="category">Publisher</div>
    </div>-->
    <div id="barchart">
        <svg width="600" height="1800"></svg>
    </div>
    <div id="genre_pie"></div>



<script type="module">
    const svg = d3.select("svg");

    const width = +svg.attr('width');
    const height = +svg.attr('height');

    const xAxisLabelText = 'Value';
    
    function render(data) {

        const xValue = d => d.global_sales;
        const yValue = d => d.name;
        
        const margin = { top: 50, right: 40, bottom: 77, left: 180 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const xScale = d3.scaleLinear()
            .domain([0, d3.max(data, xValue)])
            .range([0, innerWidth]);
  
        const yScale = d3.scaleBand()
            .domain(data.map(yValue))
            .range([0, innerHeight])
            .padding(0.1);

        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        const xAxisTickFormat = number =>
            d3.format('.3s')(number)
            .replace('G', 'B');
  
        const xAxis = d3.axisBottom(xScale)
            .tickFormat(xAxisTickFormat)
            .tickSize(-innerHeight);

        g.append('g')
            .call(d3.axisLeft(yScale))
            .selectAll('.domain, .tick line')
            .remove();

        const xAxisG = g.append('g').call(xAxis)
            .attr('transform', `translate(0,${innerHeight})`);
  
        xAxisG.select('.domain').remove();
  
        xAxisG.append('text')
            .attr('class', 'axis-label')
            .attr('y', 65)
            .attr('x', innerWidth / 2)
            .attr('fill', 'black')
            .text(xAxisLabelText);
      
        g.selectAll('rect').data(data)
            .enter().append('rect')
            .attr('y', d => yScale(yValue(d)))
            .attr('width', d => xScale(xValue(d)))
            .attr('height', yScale.bandwidth());
      
        
        console.log(data)
    }
   
    fetch("../static/data.json")
        .then(file => file.json())
        .then(data => render(data.slice(0, 10000)));




</script>


</body>

</html>